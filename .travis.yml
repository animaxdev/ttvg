language: cpp

addons:
  apt_packages:
    - libgl1-mesa-dev
    - xorg-dev
    - libxcb-render-util0-dev
    - libxcb-xkb-dev
    - libxcb-icccm4-dev
    - libudev-dev
    - libfreetype6-dev
    - libxcb-image0-dev
    - libxcb-keysyms1-dev
    - libxcb-xinerama0-dev
    - gcc-9
    - g++-9
  homebrew:
    packages:
    - llvm@9

install:
  # The following Homebrew packages aren't linked by default, and need to be
  # prepended to the path explicitly.
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then
      export PATH="$(brew --prefix llvm)/bin:$PATH";
    fi
  # /usr/bin/gcc points to an older compiler on both Linux and macOS.
  - if [ "$CXX" = "g++" ]; then export CXX="g++-9" CC="gcc-9"; fi
  # /usr/bin/clang points to an older compiler on both Linux and macOS.
  #
  # Homebrew's llvm package doesn't ship a versioned clang++ binary, so the values
  # below don't work on macOS. Fortunately, the path change above makes the
  # default values (clang and clang++) resolve to the correct compiler on macOS.
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then
      if [ "$CXX" = "clang++" ]; then export CXX="clang++-9" CC="clang-9"; fi;
    fi
  - echo ${CC}
  - echo ${CXX}
  - ${CXX} --version
  - cmake --version

before_script:
- mkdir build && cd build
- conan --version
- conan remote add bincrafters https://api.bintray.com/conan/bincrafters/public-conan
- conan remote add owl https://api.bintray.com/conan/zethon/owl
- conan install .. -s build_type=${CONFIG} --build missing
- cmake .. -DCMAKE_BUILD_TYPE=${CONFIG} -DUNIT_TEST=ON

script:
- cmake --build .
- ctest -VV -C ${CONFIG} --schedule-random --output-on-failure

matrix:
  include:

  - name: "macOS Xcode 10 Debug"
    os: osx
    compiler: clang-9
    osx_image: xcode10

    install:
      - pip install conan
    env:
      - CONFIG=Debug

  - name: "macOS Xcode 10 Release"
    os: osx
    compiler: clang-9
    osx_image: xcode10
    install:
      - pip install conan
    env:
      - CONFIG=Release

  - name: "Linux gcc Debug"
    os: linux
    dist: bionic
    compiler: gcc
    services: xvfb
    before_install:
      - "export DISPLAY=:99.0"
    install:
      - pip install conan
    env:
      - CONFIG=Debug

  - name: "Linux gcc Release"
    os: linux
    dist: bionic
    compiler: gcc
    services: xvfb
    before_install:
      - "export DISPLAY=:99.0"
    install:
      - pip install conan
    env:
      - CONFIG=Release

notifications:
  email: false

